<workflow-app name="result_to_community_from_semrel_propagation" xmlns="uri:oozie:workflow:0.5">
<parameters>
    <property>
        <name>sourcePath</name>
        <description>the source path</description>
    </property>
    <property>
        <name>allowedsemrels</name>
        <description>the semantic relationships allowed for propagation</description>
    </property>
    <property>
        <name>sparkDriverMemory</name>
        <description>memory for driver process</description>
    </property>
    <property>
        <name>sparkExecutorMemory</name>
        <description>memory for individual executor</description>
    </property>
    <property>
        <name>sparkExecutorCores</name>
        <description>number of cores used by single executor</description>
    </property>
    <property>
        <name>isLookupUrl</name>
        <description>the isLookup service endpoint</description>
    </property>
</parameters>

<start to="ResultToCommunityFromSemRelPropagation"/>

<kill name="Kill">
    <message>Action failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message>
</kill>

<action name="ResultToCommunityFromSemRelPropagation">
    <spark xmlns="uri:oozie:spark-action:0.2">
        <job-tracker>${jobTracker}</job-tracker>
        <name-node>${nameNode}</name-node>
        <master>yarn-cluster</master>
        <mode>cluster</mode>
        <name>ResultToCommunitySemRelPropagation</name>
        <class>eu.dnetlib.dhp.resulttoorganizationfrominstrepo.SparkResultToOrganizationFromIstRepoJob</class>
        <jar>dhp-propagation-${projectVersion}.jar</jar>
        <spark-opts>--executor-memory ${sparkExecutorMemory}
            --executor-cores ${sparkExecutorCores}
            --driver-memory=${sparkDriverMemory}
            --conf spark.extraListeners="com.cloudera.spark.lineage.NavigatorAppListener"
            --conf spark.sql.queryExecutionListeners="com.cloudera.spark.lineage.NavigatorQueryListener"
        </spark-opts>
        <arg>-mt</arg> <arg>yarn-cluster</arg>
        <arg>--sourcePath</arg><arg>${sourcePath}</arg>
       <arg>--allowedsemrels</arg><arg>${allowedsemrels}</arg>
        <arg>--hive_metastore_uris</arg><arg>${hive_metastore_uris}</arg>
        <arg>--isLookupUrl</arg><arg>${isLookupUrl}</arg>
    </spark>
    <ok to="End"/>
    <error to="Kill"/>
</action>

<end name="End"/>
</workflow-app>